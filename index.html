<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/black.css" id="theme">
	<link rel="shortcut icon" href="favicon.png">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section data-background-color="rgb(170, 42, 202)" data-auto-animate data-background-transition='zoom'>
				<h4 data-id="head">项目名称：点菜管理信息系统</h4>
				<p>项目成果</p>
				<img src="https://cdn.jsdelivr.net/gh/ClarkKenty/Pic_bed/img/20210705144511.png" alt="">
				<p>
					<a href="http://47.100.13.251/" target="_blank">Link</a>
				</p>
			</section>
			<section data-background-color="rgb(1, 185, 93)" data-auto-animate data-background-transition='zoom'>
				<section data-auto-animate>
					<h4 data-id="head">登录界面</h4>


					<img style="opacity: 0.7;"
						src="https://cdn.jsdelivr.net/gh/ClarkKenty/Pic_bed/img/20210705144835.png" />

				</section>
				<section data-auto-animate>
					<h4 data-id="head">代码细节</h4>
					<p>数据库连接</p>
					<pre><code class="language-php" data-trim data-line-numbers="1-5|8-9|11-15">
//connectDB.php
<?php
$servername = "localhost";//服务器名称
$username = "test";//用户名称
$password = "";//用户密码
$dbname = "food_order_system";//数据库名称

// 创建连接
$conn = new mysqli($servername, $username, $password, $dbname);

// 检测连接
if ($conn->connect_error) {
    die("连接失败: " . $conn->connect_error);
} else {
}


					</code></pre>
				</section>
				<section data-auto-animate>
					<h4 data-id="head">代码细节</h4>
					<p>用户点击注册按钮，将信息插入数据库</p>
					<pre><code class="language-php" data-trim data-line-numbers="1-5|6|8|9-12">
<?php
$username2 = $_GET["username"];//获取输入框中的用户名信息
$password2 = $_GET["password"];//获取输入框中的密码信息
$email = $_GET["email"];//获取邮箱
$phone = $_GET["phone"];//获取电话号码
if ($_SERVER["REQUEST_METHOD"] == "GET") {//用户点击注册按钮
if (!($username2 == '' || $password2 == '' || $email == '' || $phone == '')) {
$sql = "INSERT INTO user VALUES ('$username2','$password2','$email','$phone')";
if ($conn->query($sql) === TRUE) {
<!-- echo "<script language='javascript'>alert('注册成功！'); window.location = 'index.php';</script>";; -->
} else {
<!-- echo "<script language='javascript'>alert('注册失败！'); window.location = 'index.php'</script>"; -->
}
}
}
							
							
												</code></pre>
				</section>
				<section data-auto-animate>
					<h4 data-id="head">代码细节</h4>
					<p>用户点击登录按钮，进行数据库的检索</p>
					<pre><code class="language-php" data-trim data-line-numbers="1|2-3|4|5-6|8-13|14-16">
						require_once 'connectDB.php';//连接数据库
						$username = $_POST["username"];
						$password = $_POST["password"];
						if ($_SERVER["REQUEST_METHOD"] == "POST") {
							$sql = "SELECT * FROM user WHERE username = '$username'";
							$result = $conn->query($sql);
							$row = $result->fetch_assoc();
							if ($row['password'] == $password && $username != '') {//信息与数据库匹配
								if ($username == 'admin') {
									<!-- echo "<script language='javascript'>alert('登录成功！'); window.location.href='./manager/manager.php'</script>"; -->
									return;
								}
								<!-- echo "<script language='javascript'>alert('登录成功！'); window.location.href='index.html?username=$username'</script>";; -->
							} else {//信息不匹配
								<!-- echo "<script language='javascript'>alert('登录失败！'); </script>";; -->
							}
						}
												</code></pre>
				</section>
			</section>
			<section data-background-color="rgb(70, 70, 255)" data-auto-animate data-background-transition='zoom'>
				<section data-auto-animate>
					<h4 data-id="head">代码细节</h4>
					<p>用户点击结算按钮，前端将订单数据发送给服务器</p>
					<pre><code class="language-js" data-trim data-line-numbers="1-12|31-36|38-50">
						//script.js
						jiesuan.onclick = () => {//添加点击监听事件
							//获取订单数据
							let names = float_menu.getElementsByClassName('food_name');
							let food_price = float_menu.getElementsByClassName('food_price');
							let food_number = float_menu.getElementsByClassName('food_number');
							let single_price = float_menu.getElementsByClassName('single_price');
							let sum_money = document.getElementById('sum_money');
							let names_data = new Array(names.length);
							let food_price_data = new Array(names.length);
							let food_number_data = new Array(names.length);
							let single_price_data = new Array(names.length);
							for (let i = 0; i < names.length; i++) {
								names_data[i] = names[i].innerText;
								food_price_data[i] = food_price[i].innerText;
								food_number_data[i] = food_number[i].innerText;
								single_price_data[i] = single_price[i].innerText;
							}
							if (names.length == 1) {
								alert("无法提交空订单！");
								return;
							}
							names_data.shift();
							food_price_data.shift();
							food_number_data.shift();
							single_price_data.shift();
							let user = new Array(1);
							let url = location.search;
							user[0] = url.substr(url.indexOf('?') + 10);
							
							//将数据存入用json编码
							var jsonString1 = JSON.stringify(names_data);
							var jsonString2 = JSON.stringify(food_price_data);
							var jsonString3 = JSON.stringify(food_number_data);
							var jsonString4 = JSON.stringify(single_price_data);
							var jsonString5 = JSON.stringify(user);
					
							//使用ajax将数据发送给后台
							jQuery.ajax({
								type: "POST",
								url: "insertDB.php",
								data: { name: jsonString1, food_price_data: jsonString2, food_number_data: jsonString3, single_price_data: jsonString4, user: jsonString5 },
								cache: false,
								success: function (msg) {
									alert("下单成功 ");
									//下单成功后转入等待页面
									window.location = 'wait.html?index=' + msg;
								}
							});
						}
												</code></pre>
				</section>
				<section data-auto-animate>
					<h4 data-id="head">代码细节</h4>
					<p>用户点击结算按钮，将订单及订单项插入数据库</p>
					<pre><code class="language-php" data-trim data-line-numbers="4-9|23-24|33-34">
//insertDB.php
<?php
require_once "connectDB.php";
//从前端获取数据，将json数据进行解码
$name = json_decode(stripslashes($_POST['name']));//存储所有菜品名称
$food_price_data = json_decode(stripslashes($_POST['food_price_data']));//存储所有菜品单价
$food_number_data = json_decode(stripslashes($_POST['food_number_data']));//存储所有菜品数量
$single_price_data = json_decode(stripslashes($_POST['single_price_data']));//存储所有菜品价格
$customer = json_decode(stripslashes($_POST['user']));//存储用户名字
$ok = 0;
$sum = 0;
$sql = "SELECT * FROM orders";
$result = $conn->query($sql);
$index = (int) 10000;
while ($row = $result->fetch_assoc()) {
  $index = (int)$row["ID"] + 1;
}
$time = date("Y-m-d H:i:s");
for ($i = 0; $i < count($name); $i++) {
  $food_price_data[$i] = (int)$food_price_data[$i];
  $food_number_data[$i] = (int)$food_number_data[$i];
  $single_price_data[$i] = (int)$single_price_data[$i];
  $sql = "INSERT INTO order_items VALUES ('$index','$name[$i]','$food_price_data[$i]','$food_number_data[$i]','$single_price_data[$i]')";
  //将每个菜品插入表order_items
  if ($conn->query($sql) === TRUE) {
  } else {
    echo $conn->error;
    $ok++;
  };
  $sum += $single_price_data[$i];
}
if (!$ok) {
//将订单插入表orders
  $sql = "INSERT INTO orders VALUES ('$index','$customer[0]','$sum','$time')";
  if ($conn->query($sql) === TRUE) {
  } else {
    echo $conn->error;
    $ok++;
  }
}
if ($ok) {
  echo "订单生成失败！";
} else {
  echo $index;
}

												</code></pre>
				</section>

			</section>
			<section data-background-color="rgb(38, 135, 190)" data-auto-animate>
				<section data-auto-animate>
					<h4 data-id="head">代码细节</h4>
					<p>管理员界面</p>
					<p>进入页面后进行初始化，从服务端请求所有订单数据，并生成相应的dom结点插入页面中</p>
					<pre><code class="language-js" data-trim data-line-numbers="1-7|9-28|31-41|42-54">
						//利用ajax向服务端请求订单数据
						jQuery.ajax({
							type: "POST",
							url: "getorders.php",
							cache: false,
							dataType: "json",
							success: function(msg) {
								origin_id = msg.id;
								Date.prototype.format = function(fmt) {//日期格式化函数
									var o = {
										"M+": this.getMonth() + 1, //月份 
										"d+": this.getDate(), //日 
										"h+": this.getHours(), //小时 
										"m+": this.getMinutes(), //分 
										"s+": this.getSeconds(), //秒 
										"q+": Math.floor((this.getMonth() + 3) / 3), //季度 
										"S": this.getMilliseconds() //毫秒 
									};
									if (/(y+)/.test(fmt)) {
										fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
									}
									for (var k in o) {
										if (new RegExp("(" + k + ")").test(fmt)) {
											fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
										}
									}
									return fmt;
								}
								for (let i = 0; i < msg.id.length; i++) {
									//插入已完成订单
									if (new Date().getTime() - new Date(msg.time[i]).getTime() >= 120 * 1000) {
										let box = document.createElement('div');
										box.classList.add('box');
										box.innerHTML = `<div class="id">订单ID:${msg.id[i]}</div>
										<div class="customer">客户名称：${msg.customer[i]}</div>
										<div class="price">订单总额：￥${msg.total_price[i]}</div>
										<div class="time">下单时间：${msg.time[i]}</div>
										<div class="time">完成时间：${(new Date(new Date(msg.time[i]).getTime()+120*1000)).format("yyyy-MM-dd hh:mm:ss")}</div>
										<div class="more_info move">查看详情</div>`
										document.getElementById('panel2').appendChild(box);
									}
									//插入进行中订单
									 else {
										let box = document.createElement('div');
										box.classList.add('box');
										box.innerHTML = `<div class="id">订单ID:${msg.id[i]}</div>
										<div class="customer">客户名称：${msg.customer[i]}</div>
										<div class="price">订单总额：￥${msg.total_price[i]}</div>
										<div class="time">下单时间：${msg.time[i]}</div>
										<div class="time">预计完成时间：${(new Date(new Date(msg.time[i]).getTime()+120*1000)).format("yyyy-MM-dd hh:mm:ss")}</div>
										<div class="more_info move">查看详情</div>`
										document.getElementById('panel1').appendChild(box);
									}
								}

												</code></pre>
				</section>
			</section>
			<section data-background-color="rgb(14, 184, 99)" data-auto-animate>
				<h4 data-id="head">代码细节</h4>
				<p>管理员界面</p>
				<p>管理员点击查看详情按钮，显示详情面板</p>
				<pre><code class="language-js" data-trim data-line-numbers="2-3|9-17|18-24">
					for (let i = 0; i < discover.length; i++) {
						//添加点击事件
                        discover[i].onclick = function() {
                            document.getElementById('float-menu').innerHTML = `<h3 style="text-align: center;">订单详情</h3><p><span class="food_name">名称</span><span class="food_price">单价</span><span class="food_number">数量</span><span class="single_price">价格</span></p>`;
                            info.style = 'display:block';
                            let data = new Array(1);
                            data[0] = id[i].innerText.substr(5);
                            var jsonString1 = JSON.stringify(data);
                            jQuery.ajax({
                                type: "POST",
                                url: "getinfo.php",
                                dataType: "json",
                                data: {
                                    id: jsonString1
                                },
                                cache: false,
                                success: function(msg) {
									//成功请求信息后，将信息插入详情面板中
                                    for (let i = 0; i < msg.name.length; i++) {
                                        let row = document.createElement('p');
                                        row.innerHTML = `<span class="food_name">${msg.name[i]}</span><span class="food_price">${msg.price[i]}</span><span class="food_number">${msg.quantity[i]}</span><span class="single_price">${msg.sum[i]}</span>`;
                                        document.getElementById('float-menu').appendChild(row);
                                    }
                                }
                            });
												</code></pre>
			</section>
			<section data-background-color="rgb(190, 124, 38)" data-auto-animate>
				<h4 data-id="head">代码细节</h4>
				<p>管理员界面</p>
				<p>管理员删除订单按钮</p>
				<pre><code class="language-php" data-trim data-line-numbers="3-4|5-7|8-12|13-16">
<?php
require_once "connectDB.php";
//获取删除订单的ID
$id = $_POST['id'];
//执行删除操作
$sql = "SELECT * FROM orders WHERE ID = '$id';";
$result = $conn->query($sql);
if ($result->num_rows > 0) {
    $sql = "DELETE FROM orders WHERE ID = '$id';";
    $result = $conn->query($sql);
	//删除成功，返回1给客户端,页面将显示删除成功
    echo 1;
} else {
	//删除失败，返回0给客户端，页面将显示删除失败
    echo 0;
}

												</code></pre>
			</section>
			</section>
			<section data-background-color="rgb(121, 185, 46)" data-auto-animate>
				<h4 data-id="head">代码细节</h4>
				<p>管理员界面</p>
				<p>管理员修改订单按钮</p>
				<pre><code class="language-js" data-trim data-line-numbers="3-6|7-9|10-23">
					<?php
					require_once "connectDB.php";
					//获取前端发送的信息
					$id = $_POST['id'];
					$name = $_POST['name'];
					$sum = $_POST['sum'];
					//先查询该订单ID是否存在，若不存在，返回失败值‘0’
					$sql = "SELECT * FROM orders WHERE ID = '$id';";
					$result = $conn->query($sql);
					if ($result->num_rows > 0) {
						//订单存在，进行修改操作
						if ($name != "") {
							$sql = "UPDATE orders set customer = '$name' WHERE ID = '$id';";
							$result = $conn->query($sql);
						}
						if ($sum != "") {
							$sql = "UPDATE orders set total_price = '$sum' WHERE ID = '$id';";
							$result = $conn->query($sql);
						}
						echo 1;
					} else {
						echo 0;
					}
					
												</code></pre>
			</section>
		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,
			backgroundTransition: 'convex',
			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>
</body>

</html>